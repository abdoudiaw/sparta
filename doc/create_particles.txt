"SPARTA WWW Site"_sws - "SPARTA Documentation"_sd - "SPARTA Commands"_sc :c

:link(sws,http://sparta.sandia.gov)
:link(sd,Manual.html)
:link(sc,Section_commands.html#comm)

:line

create_particles command :h3

[Syntax:]

create_particles mix-ID style args keyword value ... :pre

mix-ID = ID of mixture to use when creating particles :ulb,l
style = {n} or {single} :l
  {n} args = Np
    Np = 0 or number of particles to create
  {single} args = species-ID x y z vx vy vz
    species-ID = ID of species of single particle
    x,y,z = position of particle (distance units)
    vx,vy,vz = velocity of particle (velocity units) :pre
zero or more keyword/value pairs may be appended :l
keyword = {global} or {region} or {species} or {density} or {set} :l
  {global} value = {yes} or {no}
  {region} value = region-ID :pre
  {species} value = name = variable name to evaluate for species variation
  {density} value = name = variable name to evaluate for density variation
  {set} values = dim name
    dim = {x} or {y} or {z}
    name = name of variable to set with x, y, or z particle or grid position :pre
:ule

[Examples:]

create_particles background n 0
create_particles air n 100000 region sphere
create_particles air n 100000 global yes
create_particles air single 3 5.0 6.0 5.4 10.0 -1.0 0.0
create_particles air n 0 species mySpecies set x xpos set z zpos :pre
create_particles air n 0 density myDens set x xgrid set y ygrid :pre

[Description:]

Create particles and add them to the simulation domain.  The
attributes of individual particles, such as species and velocity, are
determined by the mixture attributes, as specied by the {mix-ID}.  In
particular the {temp}, {trot}, {tvib}, and {vstream} attributes of the
mixture affect create particle velocities and internal energy modes.
See the "mixture"_mixture.html command for more details.  Note that
this command can be used multiple times to add more and more
particles.

Particles are only created in grid cells which are entirely external
to surfaces.  Particles are not created in grid cells cut by surfaces.

IMPORTANT NOTE: When a particle is created at a specified temperature
(as set by the "mixture"_mixture.html command), it's rotational and
vibrational energy will also be initialized, consistent with the
mixture temperatures.  The {rotate} and {vibrate} options of the
"collide_modify"_collide_modify.html command determine how internal
energy modes are initialized.  If the "collide"_collide.html command
has not yet been specified, then no rotational or vibrational energy
will be assigned to created particles.  Thus if you wish to create
particles with non-zero internal energy, the "collide"_collide.html
and (optionally) "collide_modify"_collide_modify.html commands must be
used before this command.

If the {n} style is used with {Np} = 0, then the number of created
particles is calculated by SPARTA as a function of the global {fnum}
value, the mixture number density, and the flow volume of the
simulation domain.

The {fnum} value is set by the "global fnum"_global.html command.  The
mixture {nrho} is set by the "mixture"_mixture.html command.  The flow
volume of the simulation is the total volume of the simulation domain
as specified by the "create_box"_create_box.html command, minus any
volume that is interior to surfaces defined by the
"read_surf"_read_surf.html command.  Note that the flow volume
includes volume contributions from grid cells cut by surfaces.
However particles are only created in grid cells entirely external to
surfaces.  This means that particles may be created in external cells
at a (slightly) higher density to compensate for no particles being
created in cut cells that still contribute to the overall flow volume.

If the {n} style is used with a non-zero {Np}, then exactly {Np}
particles are created, which can be useful for debugging or
benchmarking purposes.

Based on the value of {Np}, each grid cell will have a target number
of particles {M} to insert, which is a function of the cell's volume
as compared to the total system flow volume.  If {M} has a fractional
value, e.g. 12.5, then 12 particles will be inserted, and a 13th
depending on the outcome of a random number generation.  As grid cells
are looped over, the remainder fraction is accumulated, so that
exactly {Np} particles are created across all the processors.

IMPORTANT NOTE: The preceeding calculation is actually done using
{weighted} cell volumes.  Grid cells can be weighted using the "global
weight"_global.html command.

Each particle is inserted at a random location within the grid cell.
The particle species is chosen randomly in accord with the {frac}
settings of the collection of species in the mixture, as set by the
"mixture"_mixture.html command.  The velocity of the particle is set
to the sum of the streaming velocity of the mixture and a thermal
velocity sampled from the thermal temperature of the mixture.  Both
the streaming velocity and thermal temperature are also set by the
"mixture"_mixture.html command.  The internal rotational and
vibrational energies of the particle are also set based on the {trot}
and {tvib} settings for the mixture, as explained above.

The {single} style creates a single particle.  This can be useful for
debugging purposes, e.g. to advect a single particle towards a
surface.  A single particle of the specified species is inserted at
the specified position and with the specified velocity.  In this case
the {mix-ID} is ignored.

:line

This is the meaning of the other allowed keywords.

The {global} keyword only applies when the {n} style is used, and
controls how particles are generated in parallel.

If the value is {yes}, then every processor loops over all {Np}
particles.  As the coordinates of each is generated, each processor
checks what grid cell it is in, and only stores the particle if it
owns that grid cell.  Thus an identical set of particles are created,
no matter how many processors are running the simulation

IMPORTANT NOTE: The {global} yes option is not yet implemented.

If the value is {no}, then each of the {P} processors generates a
{N/P} subset of particles, using its own random number generation.  It
only adds particles to grid cells that it owns, as described above.
This is a faster way to generate a large number of particles, but
means that the individual attributes of particles will depend on the
number of processors and the mapping of grid cells to procesors.  The
overall set of created particles should have the same statistical
properties as with the {yes} setting.

If the {region} keyword is used, then a particle will only added if
its position is within the specified {region-ID}.  This can be used to
only allow particle insertion within a subset of the simulation
domain.  Note that the {side} option for the "region"_region.html
command can be used to define whether the inside or outside of the
geometric region is considered to be "in" the region.

IMPORTANT NOTE: If the {region} and {n} keywords are used together,
less than N particles may be added.  This is because grid cells will
be candidates for particle insertion, unless they are entirely outside
the bounding box that encloses the region.  Particles those grid cells
attempt to add are included in the count for N, even if some or all of
the particle insertions are rejected due to not being inside the
region.

The {species} and {set} keywords can be used together to create
particles with a spatially-dependent separation of species.  The
{name} specified for the {species} keyword is the name of an
"equal-style variable"_variable.html which should evaluate to a
species number, i.e. an integer from 1 to Nsp, where Nsp is the number
of species in the mixture with mix-ID.  Since equal-style variables
evaluate to floating-point values, this value is truncated to an
integer value.  The formula for the species can use one or two or
three variables which will store the x, y, or z coordinates of the
particle that is being created.  If used, these other variables must
be "equal-style variables"_variable.html defined in the input script,
but their formula can by anything.  The {set} keyword is used to
identify the names of these other variables, one variable for the
x-coordinate of particle, one for y, and one for z.

When a particle is added, its coordinates override the formula for any
{set} variable that is defined.  The {species} variable is then
evaluated.  The returned value is used to set the species of that
particle, based on the list of species defined for the mixture.  If
the returned value is <= 0 or > Nsp = the number of species in the
mixture, then no particle is created.  After the create_particles
operation is complete, the formulas defined for all of the {set}
variables are restored to their original strings.

As an example, these commands can be used in a 2d simulation, to
create a particle distribution with species 1 on top of species 2 with
a sinudoidal interface between the two species, as illustrated in the
snapshot of the initial particle distribution.  Click on the image for
a larger version.  Note that when using this option less than the
requested N particles can be created if the species variable returns
values <= 0 or greater than the number of species in the mixture.

variable x equal 1
variable y equal 1
variable n equal 3
variable s equal "(v_y < 0.5*(ylo+yhi) + 0.15*yhi*sin(2*PI*v_n*v_x/xhi)) + 1"
create_particles species n 10000 species s set x x set y y :pre

:c,image(JPG/species_variation_small.jpg,JPG/species_variation.jpg)

The {density} and {set} keywords can be used together to create
particles with a spatially-dependent density variation.  The {name}
specified for the {density} keyword is the name of an "equal-style
variable"_variable.html which should evaluate to a positive value.
The formula for the density can use one or two or three variables
which will store the x, y, or z coordinates of the geometric center
point of a grid cell.  If used, these other variables must be
"equal-style variables"_variable.html defined in the input script, but
their formula can by anything.  The {set} keyword is used to identify
the names of these other variables, one variable for the x-coordinate
of the grid cell center point, one for y, and one for z.

When particles are added to a grid cell, its center point coordinates
override the formula for any {set} variable that is defined.  The
{density} variable is then evaluated.  The returned value is used as a
scale factor on the number of particles to create in that grid cell.
Thus a value of 0.5 would create half as many particles in that grid
cell as would otherwise be the case.  A value of 1.2 would create 20%
more particles in that grid cell.  After the create_particles
operation is complete, the formulas defined for all of the {set}
variables are restored to their original strings.

As an example, these commands can be used in a 2d simulation, to
create more particles towards the upper right corner of the domain and
less towards the lower left corner, as illustrated in the snapshot of
the initial particle distribution.  Click on the image for a larger
version.  Note that less than 10000 particles will be created because
all the scale factors generated by the variable {d} are less than 1.0.

variable x equal 1
variable y equal 1
variable d equal "v_x/xhi * v_y/yhi"
create_particles air n 10000 density d set x x set y y :pre

:c,image(JPG/density_variation_small.jpg,JPG/density_variation.jpg)

:line

[Restrictions:] none

[Related commands:]

"mixture"_mixture.html, "fix emit/face"_fix_emit_face.html

[Default:]

The option default is global = no.
