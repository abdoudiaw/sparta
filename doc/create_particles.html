<HTML>
<CENTER><A HREF = "http://sparta.sandia.gov">SPARTA WWW Site</A> - <A HREF = "Manual.html">SPARTA Documentation</A> - <A HREF = "Section_commands.html#comm">SPARTA Commands</A> 
</CENTER>






<HR>

<H3>create_particles command 
</H3>
<P><B>Syntax:</B>
</P>
<PRE>create_particles mix-ID style args keyword value ... 
</PRE>
<UL><LI>mix-ID = ID of mixture to use when creating particles 

<LI>style = <I>n</I> or <I>single</I> 

<PRE>  <I>n</I> args = Np
    Np = 0 or number of particles to create
  <I>single</I> args = species-ID x y z vx vy vz
    species-ID = ID of species of single particle
    x,y,z = position of particle (distance units)
    vx,vy,vz = velocity of particle (velocity units) 
</PRE>
<LI>zero or more keyword/value pairs may be appended 

<LI>keyword = <I>global</I> or <I>region</I> or <I>density</I> or <I>set</I> 

<PRE>  <I>global</I> value = <I>yes</I> or <I>no</I>
  <I>region</I> value = region-ID 
</PRE>
<PRE>  <I>density</I> value = name = variable name to evaluate for density variation
  <I>set</I> values = dim name
    dim = <I>x</I> or <I>y</I> or <I>z</I>
    name = name of variable to set with x, y, or z grid position 
</PRE>

</UL>
<P><B>Examples:</B>
</P>
<PRE>create_particles background n 0
create_particles air n 100000 region sphere
create_particles air n 100000 global yes
create_particles air single 3 5.0 6.0 5.4 10.0 -1.0 0.0
create_particles air n 0 density myDens set x xgrid set y ygrid 
</PRE>
<P><B>Description:</B>
</P>
<P>Create particles and add them to the simulation domain.  The
attributes of individual particles, such as species and velocity, are
determined by the mixture attributes, as specied by the <I>mix-ID</I>.  In
particular the <I>temp</I>, <I>trot</I>, <I>tvib</I>, and <I>vstream</I> attributes of the
mixture affect create particle velocities and internal energy modes.
See the <A HREF = "mixture.html">mixture</A> command for more details.  Note that
this command can be used multiple times to add more and more
particles.
</P>
<P>Particles are only created in grid cells which are entirely external
to surfaces.  Particles are not created in grid cells cut by surfaces.
</P>
<P>IMPORTANT NOTE: When a particle is created at a specified temperature
(as set by the <A HREF = "mixture.html">mixture</A> command), it's rotational and
vibrational energy will also be initialized, consistent with the
mixture temperatures.  The <I>rotate</I> and <I>vibrate</I> options of the
<A HREF = "collide_modify.html">collide_modify</A> command determine how internal
energy modes are initialized.  If the <A HREF = "collide.html">collide</A> command
has not yet been specified, then no rotational or vibrational energy
will be assigned to created particles.  Thus if you wish to create
particles with non-zero internal energy, the <A HREF = "collide.html">collide</A>
and (optionally) <A HREF = "collide_modify.html">collide_modify</A> commands must be
used before this command.
</P>
<P>If the <I>n</I> style is used with <I>Np</I> = 0, then the number of created
particles is calculated by SPARTA as a function of the global <I>fnum</I>
value, the mixture number density, and the flow volume of the
simulation domain.
</P>
<P>The <I>fnum</I> value is set by the <A HREF = "global.html">global fnum</A> command.  The
mixture <I>nrho</I> is set by the <A HREF = "mixture.html">mixture</A> command.  The flow
volume of the simulation is the total volume of the simulation domain
as specified by the <A HREF = "create_box.html">create_box</A> command, minus any
volume that is interior to surfaces defined by the
<A HREF = "read_surf.html">read_surf</A> command.  Note that the flow volume
includes volume contributions from grid cells cut by surfaces.
However particles are only created in grid cells entirely external to
surfaces.  This means that particles may be created in external cells
at a (slightly) higher density to compensate for no particles being
created in cut cells that still contribute to the overall flow volume.
</P>
<P>If the <I>n</I> style is used with a non-zero <I>Np</I>, then exactly <I>Np</I>
particles are created, which can be useful for debugging or
benchmarking purposes.
</P>
<P>Based on the value of <I>Np</I>, each grid cell will have a target number
of particles <I>M</I> to insert, which is a function of the cell's volume
as compared to the total system flow volume.  If <I>M</I> has a fractional
value, e.g. 12.5, then 12 particles will be inserted, and a 13th
depending on the outcome of a random number generation.  As grid cells
are looped over, the remainder fraction is accumulated, so that
exactly <I>Np</I> particles are created across all the processors.
</P>
<P>IMPORTANT NOTE: The preceeding calculation is actually done using
<I>weighted</I> cell volumes.  Grid cells can be weighted using the <A HREF = "global.html">global
weight</A> command.
</P>
<P>Each particle is inserted at a random location within the grid cell.
The particle species is chosen randomly in accord with the <I>frac</I>
settings of the collection of species in the mixture, as set by the
<A HREF = "mixture.html">mixture</A> command.  The velocity of the particle is set
to the sum of the streaming velocity of the mixture and a thermal
velocity sampled from the thermal temperature of the mixture.  Both
the streaming velocity and thermal temperature are also set by the
<A HREF = "mixture.html">mixture</A> command.  The internal rotational and
vibrational energies of the particle are also set based on the <I>trot</I>
and <I>tvib</I> settings for the mixture, as explained above.
</P>
<P>The <I>single</I> style creates a single particle.  This can be useful for
debugging purposes, e.g. to advect a single particle towards a
surface.  A single particle of the specified species is inserted at
the specified position and with the specified velocity.  In this case
the <I>mix-ID</I> is ignored.
</P>
<HR>

<P>This is the meaning of the other allowed keywords.
</P>
<P>The <I>global</I> keyword only applies when the <I>n</I> style is used, and
controls how particles are generated in parallel.
</P>
<P>If the value is <I>yes</I>, then every processor loops over all <I>Np</I>
particles.  As the coordinates of each is generated, each processor
checks what grid cell it is in, and only stores the particle if it
owns that grid cell.  Thus an identical set of particles are created,
no matter how many processors are running the simulation
</P>
<P>IMPORTANT NOTE: The <I>global</I> yes option is not yet implemented.
</P>
<P>If the value is <I>no</I>, then each of the <I>P</I> processors generates a
<I>N/P</I> subset of particles, using its own random number generation.  It
only adds particles to grid cells that it owns, as described above.
This is a faster way to generate a large number of particles, but
means that the individual attributes of particles will depend on the
number of processors and the mapping of grid cells to procesors.  The
overall set of created particles should have the same statistical
properties as with the <I>yes</I> setting.
</P>
<P>If the <I>region</I> keyword is used, then a particle will only added if
its position is within the specified <I>region-ID</I>.  This can be used to
only allow particle insertion within a subset of the simulation
domain.  Note that the <I>side</I> option for the <A HREF = "region.html">region</A>
command can be used to define whether the inside or outside of the
geometric region is considered to be "in" the region.
</P>
<P>IMPORTANT NOTE: If the <I>region</I> and <I>n</I> keywords are used together,
less than N particles may be added.  This is because grid cells will
be candidates for particle insertion, unless they are entirely outside
the bounding box that encloses the region.  Particles those grid cells
attempt to add are included in the count for N, even if some or all of
the particle insertions are rejected due to not being inside the
region.
</P>
<P>The <I>density</I> and <I>set</I> keywords can be used together to create
particles with a spatially-dependent density variation.  The <I>name</I>
specified for the <I>density</I> keyword is the name of an <A HREF = "variable.html">equal-style
variable</A> which should evaluate to a positive value
based on one or two or three variables which will store the x, y, or z
coordinates of the geometric center point of a grid cell.  If used,
these other variables must be <A HREF = "variable.html">equal-style variables</A>
defined in the input script, but their formula can by anything.  The
<I>set</I> keyword is used to identify the names of these other variables,
one variable for the x-coordinate of the grid cell center point, one
for y, and one for z.
</P>
<P>When particles are added to a grid cell, its center point coordinates
override the formula for any <I>set</I> variable that is defined.  The
<I>density</I> variable is then evaluated.  The returned value is used as a
scale factor on the number of particles to create in that grid cell.
Thus a value of 0.5 would create half as many particles in that grid
cell as would otherwise be the case.  A value of 1.2 would create 20%
more particles in that grid cell.  After the create_particles
operation is complete, the formulas defined for all of the <I>set</I>
variables are restored to their original strings.
</P>
<P>As an example, these commands can be used in a 2d simulation, to
create more particles towareds the upper right corner of the domain
and less towards the lower left corner.
</P>
<PRE>variable x equal 1
variable y equal 1
variable d equal "v_x/xhi * v_y/yhi"
create_particles air n 10000 density d set x x set y y 
</PRE>
<P>Note that less than 10000 particles will be created because all the
scale factors generated by the variable <I>d</I> are less than 1.0.
</P>
<HR>

<P><B>Restrictions:</B> none
</P>
<P><B>Related commands:</B>
</P>
<P><A HREF = "mixture.html">mixture</A>, <A HREF = "fix_emit_face.html">fix emit/face</A>
</P>
<P><B>Default:</B>
</P>
<P>The option default is global = no.
</P>
</HTML>
